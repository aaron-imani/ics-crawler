<!DOCTYPE html>
<html lang="en-US">
<head>

		<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	<link rel="pingback" href="http://plrg.ics.uci.edu/wordpress/xmlrpc.php" />	
<title>Jaaru &#8211; Programming Languages Research Group</title>
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Programming Languages Research Group &raquo; Feed" href="http://plrg.ics.uci.edu/feed/" />
<link rel="alternate" type="application/rss+xml" title="Programming Languages Research Group &raquo; Comments Feed" href="http://plrg.ics.uci.edu/comments/feed/" />
<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/plrg.ics.uci.edu\/wordpress\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.9.4"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='http://plrg.ics.uci.edu/wordpress/wp-includes/css/dist/block-library/style.min.css?ver=5.9.4' type='text/css' media='all' />
<style id='global-styles-inline-css' type='text/css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
</style>
<link rel='stylesheet' id='attitude_style-css'  href='http://plrg.ics.uci.edu/wordpress/wp-content/themes/attitude_mod/style.css?ver=5.9.4' type='text/css' media='all' />
<link rel='stylesheet' id='google_fonts-css'  href='//fonts.googleapis.com/css?family=PT+Sans%7CPhilosopher&#038;ver=5.9.4' type='text/css' media='all' />
<script type='text/javascript' src='http://plrg.ics.uci.edu/wordpress/wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
<script type='text/javascript' src='http://plrg.ics.uci.edu/wordpress/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='http://plrg.ics.uci.edu/wordpress/wp-content/themes/attitude_mod/library/js/tinynav.js?ver=5.9.4' id='tinynav-js'></script>
<script type='text/javascript' src='http://plrg.ics.uci.edu/wordpress/wp-content/themes/attitude_mod/library/js/backtotop.js?ver=5.9.4' id='backtotop-js'></script>
<link rel="https://api.w.org/" href="http://plrg.ics.uci.edu/wp-json/" /><link rel="alternate" type="application/json" href="http://plrg.ics.uci.edu/wp-json/wp/v2/pages/573" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://plrg.ics.uci.edu/wordpress/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://plrg.ics.uci.edu/wordpress/wp-includes/wlwmanifest.xml" /> 
<link rel="canonical" href="http://plrg.ics.uci.edu/jaaru/" />
<link rel='shortlink' href='http://plrg.ics.uci.edu/?p=573' />
<link rel="alternate" type="application/json+oembed" href="http://plrg.ics.uci.edu/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fplrg.ics.uci.edu%2Fjaaru%2F" />
<link rel="alternate" type="text/xml+oembed" href="http://plrg.ics.uci.edu/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fplrg.ics.uci.edu%2Fjaaru%2F&#038;format=xml" />

</head>

<body class="page-template-default page page-id-573 ">
	
	<div class="wrapper">
				<header id="branding" >
				
	<div class="container clearfix">
		<div class="hgroup-wrap clearfix">
								<section class="hgroup-right">
													<form action="http://plrg.ics.uci.edu/" class="searchform clearfix" method="get">
		<label class="assistive-text" for="s">Search</label>
		<input type="text" placeholder="Search" class="s field" name="s">
	</form><!-- .searchform -->
					</section><!-- .hgroup-right -->	
							<hgroup id="site-logo" class="clearfix">
												<h1 id="site-title"> 
								<a href="http://plrg.ics.uci.edu/" title="Programming Languages Research Group" rel="home">
									Programming Languages Research Group								</a>
							</h1>
																
				</hgroup><!-- #site-logo -->
			
		</div><!-- .hgroup-wrap -->
	</div><!-- .container -->	
					<img src="http://plrg.ics.uci.edu/wordpress/wp-content/uploads/2015/04/cropped-IMG_0976_small.jpg" class="header-image" width="2000" height="485" alt="Programming Languages Research Group">
				
	<nav id="access" class="clearfix">
					<div class="container clearfix"><ul class="root"><li id="menu-item-34" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-34"><a href="http://plrg.ics.uci.edu/">Brian Demsky</a></li>
<li id="menu-item-22" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22"><a href="http://plrg.ics.uci.edu/students/">Students</a></li>
<li id="menu-item-19" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-19"><a href="http://plrg.ics.uci.edu/publications_page/">Publications</a></li>
<li id="menu-item-29" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-ancestor current_page_ancestor menu-item-has-children menu-item-29"><a href="http://plrg.ics.uci.edu/software_page/">Software</a>
<ul class="sub-menu">
	<li id="menu-item-557" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home current-menu-ancestor current-menu-parent menu-item-has-children menu-item-557"><a href="http://plrg.ics.uci.edu">Software Verifiers</a>
	<ul class="sub-menu">
		<li id="menu-item-663" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-663"><a href="http://plrg.ics.uci.edu/psan/">PSan</a></li>
		<li id="menu-item-638" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-638"><a href="http://plrg.ics.uci.edu/yashme/">Yashme</a></li>
		<li id="menu-item-585" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-573 current_page_item menu-item-585"><a href="http://plrg.ics.uci.edu/jaaru/" aria-current="page">Jaaru</a></li>
		<li id="menu-item-558" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-558"><a href="http://plrg.ics.uci.edu/satune/">Satune</a></li>
		<li id="menu-item-455" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-455"><a href="http://plrg.ics.uci.edu/c11tester/">C11Tester</a></li>
	</ul>
</li>
	<li id="menu-item-396" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-396"><a href="http://plrg.ics.uci.edu/software-relaxed-mm/">Software for Relaxed Memory Models</a></li>
	<li id="menu-item-83" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-83"><a href="http://plrg.ics.uci.edu/software_page/irvine-research-java-compiler/">Irvine Research Java Compiler</a></li>
	<li id="menu-item-77" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-77"><a href="http://plrg.ics.uci.edu/software_page/views/">Views</a></li>
	<li id="menu-item-528" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-has-children menu-item-528"><a href="http://plrg.ics.uci.edu">Smart Home</a>
	<ul class="sub-menu">
		<li id="menu-item-520" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-520"><a href="http://plrg.ics.uci.edu/fidelius/">Fidelius</a></li>
		<li id="menu-item-513" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-513"><a href="http://plrg.ics.uci.edu/iotcheck/">IoTCheck</a></li>
		<li id="menu-item-487" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-487"><a href="http://plrg.ics.uci.edu/pingpong/">PingPong</a></li>
		<li id="menu-item-358" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-358"><a href="http://plrg.ics.uci.edu/vigilia/">Vigilia</a></li>
	</ul>
</li>
</ul>
</li>
<li class="default-menu"><a href="http://plrg.ics.uci.edu" title="Navigation">Navigation</a></li></ul></div><!-- .container -->
					</nav><!-- #access --> 		
				</header>
		
				<div id="main" class="container clearfix">

<div id="container">
	

<div id="content">	<section id="post-573" class="post-573 page type-page status-publish hentry">
		<article>

			
			<header class="entry-header">
    			<h1 class="entry-title">
<!--    				Jaaru -->
    			</h1><!-- .entry-title -->
  			</header>

  			
  			
  			<div class="entry-content clearfix">
    			
<h2>Jaaru: Efficiently Model Checking Persistent Memory Programs</h2>



<p>Recently persistent memory technologies have become commercially available. Ensuring that persistent data structures are crash-consistent (i.e., power failures) is a major challenge. Stores to persistent memory are not immediately made persistent &#8212; they initially reside in processor cache and are only written to persistent memory when space constraints or explicit flush operations force the cache line to be written to persistent memory. Testing crash consistency is extremely difficult.</p>



<p>We present the first efficient model checking algorithm for persistent memory. We introduce a new constraint refinement-based partial order technique that reduces the number of executions that must be explored by many orders of magnitude. Our technique explores all possible executions that arise from the non-determinism from cache line persistency. For common persistent data structure coding patterns, our technique reduces the model checking complexity from exponential in the length of program executions to quadratic. We have implemented this approach in the tool Jaaru, and show that Jaaru can find persistency bugs in all of our benchmarks.</p>



<p>In the following, you will the step-by-step procedure for setting up Jaaru on vagrant (i.e., a virtual machine) and how to use Jaaru to debug your tools. If you want to use Jaaru on your machine you can skip the instructions for setting up the virtual machine. As a working example, we will show the steps to found bugs in RECIPE and PMDK. </p>



<h2>Setting up Jaaru</h2>



<p>This section shows how to setup Jaaru on any Linux machine. You can use our <a href="https://github.com/uci-plrg/jaaru-vagrant">artifact evaluation</a> to automatically setup Jaaru and the benchmarks on a virtual machine or you can use the following step-by-step tutorial to setup up Jaaru on your machine.</p>



<h3>Dependencies</h3>



<p>To properly set up Jaaru, some packages are required. Use the following commands to install all the necessary dependencies:</p>



<pre class="wp-block-code"><code>sudo apt-get update
sudo apt-get -y install cmake g++</code></pre>



<h3>Setting up Vagrant</h3>



<p>Use the following commands to set up a virtual machine (i.e., Vagrant) in ~/jaaru directory:</p>



<pre class="wp-block-code"><code>sudo apt-get -y vagrant virtual-box
cd ~/jaaru
vagrant init hashicorp/bionic64</code></pre>



<p>If you want to build LLVM in your virtual machine, you need to specify more memory to your VM. In order to increase the memory add the following config in the configuration file (i.e., Vagrantfile):</p>



<pre class="wp-block-code"><code>config.disksize.size = '80GB'
config.vm.provider :virtualbox do |v|
   v.customize &#91;"modifyvm", :id, "--memory", 8172]
   v.customize &#91;"modifyvm", :id, "--cpus", "4"]
end</code></pre>



<p>Now you can start your VM and ssh to it:</p>



<pre class="wp-block-code"><code>vagrant up
vagrant ssh</code></pre>



<h3>Building PMCPass</h3>



<p>Jaaru requires an LLVM pass (i.e., PMCPass) to annotate all loads/stores of your tool. You can download the binary file from <a href="https://drive.google.com/drive/folders/1FH6uKohoSZXrf1Twq55ZUTI6DzNVYzts?usp=sharing">here</a> or build the PMCPass with LLVM. To build it you need to download LLVM and register our pass and build it:</p>



<pre class="wp-block-code"><code>git clone https://github.com/llvm/llvm-project.git
git clone https://github.com/uci-plrg/jaaru-llvm-pass
cd llvm-project
git checkout 7899fe9da8d8df6f19ddcbbb877ea124d711c54b
cd ../jaaru-llvm-pass
git checkout 0b639997a1a990cfaa0adb29a4f3a1c9f784d8ca 
cd ..
mv jaaru-llvm-pass llvm-project/llvm/lib/Transforms/PMCPass</code></pre>



<p>To register our pass in LLVM append &#8216;add_subdirectory(PMCPass)&#8217;  to  CMakeLists.txt file in &#8216;Transforms&#8217; directory by using the following command:</p>



<pre class="wp-block-code"><code>echo "add_subdirectory(PMCPass)" &gt;&gt; llvm-project/llvm/lib/Transforms/CMakeLists.txt</code></pre>



<p>After registering the pass, use the following commands to build it:</p>



<pre class="wp-block-code"><code>cd llvm-project
mkdir build
cd build
cmake -DLLVM_ENABLE_PROJECTS=clang -G "Unix Makefiles" ../llvm
make</code></pre>



<p>To verify the building process was successful, our pass can be find in the following directory:</p>



<pre class="wp-block-code"><code>touch llvm-project/build/lib/libPMCPass.so</code></pre>



<h3>Setting up Jaaru</h3>



<p>This section shows how to setup Jaaru (i.e., PMCheck) and use it to debug RECIPE benchmarks and PMDK benchmarks. To download and build Jaaru use the following commands:</p>



<pre class="wp-block-code"><code>cd ~/
git clone https://github.com/uci-plrg/jaaru
mv jaaru pmcheck
cd pmcheck/
git checkout b4a60d7110e7d5f8849c771b84ee09c81e216186
make</code></pre>



<p>Jaaru supports different APIs to access the persistent memory including <a href="https://github.com/pmem/pmdk/">pmem </a>in PMDK library and volatile memory allocator (<a href="https://pmem.io/pmdk/manpages/linux/v1.3/libvmmalloc.3.html">libvmemmalloc</a>). In PMDK there are separate APIs for allocating persistent memory. However, libvmemmalloc overrides normal malloc API to allocate memory on persistent memory instead of RAM. If the tool-under-test uses libvmemmalloc, a flag needs to be set in Jaaru to activate the corresponding support. to do that uncomment the following flag in &#8216;pmcheck/config.h&#8217; file and recompile Jaaru:  </p>



<pre class="wp-block-code"><code>//In config.h file uncomment the following line
#define ENABLE_VMEM</code></pre>



<h3>Running your tools</h3>



<p>To run your test cases, you need to compile your tool with Jaaru (i.e., pmcheck) and our LLVM pass (i.e., PMCPass). To make this process easier, we use a coding pattern which is described as follows: If you check &#8216;pmcheck/Test&#8217; directory, there are 4 scripting files g++, gcc, clang, and clang++. In each of these files we define appropriate flags for the compiler. You can modify &#8216;LLVMDIR&#8217; and &#8216;JAARUDIR&#8217; environment variables in these files to point to the location of LLVM and Jaaru (i.e., PMCheck) on your machine. Then, modify the building system of your tool to use these script wrappers instead of the actual compilers. For example, your &#8216;~/pmcheck/Test/g++&#8217; file can look like this:</p>



<pre class="wp-block-code"><code>LLVMDIR=~/llvm-project/
CC=${LLVMDIR}/build/bin/clang++
LLVMPASS=${LLVMDIR}/build/lib/libPMCPass.so
JAARUDIR=~/pmcheck/bin/
$CC -Xclang -load -Xclang $LLVMPASS -L${JAARUDIR} -lpmcheck -Wno-unused-command-line-argument -Wno-address-of-packed-member -Wno-mismatched-tags -Wno-unused-private-field -Wno-constant-conversion -Wno-null-dereference $@</code></pre>



<p>To verify the script wrappers you can build our test cases without any errors:</p>



<pre class="wp-block-code"><code>cd ~/pmcheck/
make test</code></pre>



<h3>Debugging RECIPE</h3>



<p>For evaluating Jaaru, we tested it on <a href="https://github.com/utsaslab/RECIPE">RECIPE</a> benchmarks. RECIPE uses libvmemmalloc to access persistent memory, so vmem flag has to be activated to debug this benchmark (See Setting up Jaaru). We found a couple of bugs that we reported them all and they are fixed by the authors. Here you can download the working version of the RECIPE that contains our bug fixes: </p>



<pre class="wp-block-code"><code>git clone https://github.com/uci-plrg/nvm-benchmarks
cd nvm-benchmarks
git checkout 4fb82ecb29cdec628630f9433c58813f44aabf90
cd RECIPE</code></pre>



<p>To compile and run any benchmarks, you need to modify the Makefile to change the compiler to point to the corresponding wrapper script. For example in FAST_FAIR makefile add the following line:</p>



<pre class="wp-block-code"><code>CXX=~/pmcheck/Test/g++</code></pre>



<p>To run each test case, you need to replace the &#8216;run&#8217; file in &#8216;nvm-benchmarks&#8217; directory. Here&#8217;s how it should look:</p>



<pre class="wp-block-code"><code>export LD_LIBRARY_PATH=~/pmcheck/bin/
</code></pre>



<p>Now you can run RECIPE benchmarks by using &#8216;run.sh&#8217; script file. For instance, to run FAST_FAIR with two threads and 3 keys we use the following command:</p>



<pre class="wp-block-code"><code>./run.sh ./example 3 2</code></pre>



<p>The bugs that we found in RECIPE and PMDK are guarded by &#8216;BUGFIX&#8217; flag. To reproduce the bugs, one needs to comment out our fix and run the program with Jaaru. Then, it can be observed Jaaru can find an execution that crashes the program without that fix. </p>



<h2>Disclaimer</h2>



<p>We make no warranties&nbsp;that Jaaru is free of errors.&nbsp;Please read the paper and the README file so that you understand what the tool is supposed to do.</p>



<h2>Contact</h2>



<p>Please feel free to contact us for more information. Bug reports are welcome, and we are happy to hear from our users.</p>



<p>Contact Hamed Gorjiara at <a href="mailto:rtrimana@uci.edu">hgorjiar@uci.edu</a>, Harry Xu at <a href="mailto:harryxu@g.ucla.edu">harryxu@g.ucla.edu</a>, or Brian Demsky at <a href="mailto:bdemsky@uci.edu">bdemsky@uci.edu</a>&nbsp;for any questions about Jaaru.</p>



<h2>Copyright</h2>



<p>Copyright © 2020 Regents of the University of California. All rights reserved.</p>
    			  			</div>

  			
<div id="comments" class="comments-area">

	
	
	
</div><!-- #comments .comments-area -->
		</article>
	</section>
</div><!-- #content --></div><!-- #container -->


	   </div><!-- #main -->

	   
	   	
	   
	   <footer id="colophon" class="clearfix">
			


<div id="site-generator">
				<div class="container"><div style="clear:both;"></div>
			</div><!-- .container -->
			</div><!-- #site-generator --><div class="back-to-top"><a href="#branding">Back to Top</a></div>		</footer>
	   
			

	</div><!-- .wrapper -->

	 


</body>
</html>